<!DOCTYPE html>
<html lang="zh-Hant" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>老屋手札</title>
    <link rel="stylesheet" href="../css/cart.css">
    <link rel="stylesheet" href="../css/common/all.css">
    <link rel="stylesheet" href="../css/common/header.css">
    <link rel="stylesheet" href="../css/common/footer.css">
    <!-- 載入Google Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons"
      rel="stylesheet">
    <!-- 載入jQuey -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  </head>
  <body>

    <header class="header">
      <div class="small_logo">
        <a class="nav_link" href="./index.html"><img src="../images/logo.png" alt="logo image"></a>
      </div>
      <nav class="nav_flex_container -hidden">
        <div class="nav_flex_item page">
          <a class="nav_link" href="./exploring.html">老屋探索</a>
        </div>
        <div class="nav_flex_item page">
          <a class="nav_link" href="./story.html">老屋故事</a>
        </div>
        <div class="nav_flex_item logo">
          <a class="nav_link" href="./index.html"><img src="../images/logo.png" alt="logo image"></a>
        </div>
        <div class="nav_flex_item page">
          <a class="nav_link" href="./product.html">文創商品</a>
        </div>
        <div class="nav_flex_item page" >
          <a class="nav_link" href="#">我的最愛</a>
        </div>
      </nav>

      <div class="nav_switch_outside">
        <div class="nav_switch"></div>
      </div>

      <div class="header_right">
        <a class="cart_link -on" href="./cart.html">
          <span class="material-icons cart">&#xe8cc;</span>
        </a>
      </div>
    </header>

    <main class="main">

      <!-- <div class="decoration_pic">
        <span class="decoration_text"></span>
        <div class="decoration_pic_1"></div>
        <div class="decoration_pic_2"></div>
        <div class="decoration_pic_3"></div>
        <div class="decoration_pic_4"></div>
      </div> -->

      <h1 class="title1">我的購物車</h1>
      <div class="hr_line"></div>

      <div class="cart">

        <div class="column_name">
          <span class="item">品項</span>
          <span class="price">價格</span>
          <span class="number">數量</span>
          <span class="total">小計</span>
        </div>
        <div class="inner_hr_line"></div>

        <div class="product product1">
          <img class="product_pic" src="../images/product_pic1.jpg">
          <h2 class="product_name">鐵窗花畫板——富士山</h2>
          <button class="trash">
            <span class="material-icons cart">&#xe872;</span>
          </button>
          <span class="price" data-price="110">$110</span>
          <div class="number">
            <button class="add">+</button>
            <span class="number">2</span>
            <button class="subtract">-</button>
          </div>
          <span class="total">$220</span>
        </div>

        <div class="product product2">
          <img class="product_pic" src="../images/product_pic2.jpg">
          <h2 class="product_name">鐵窗花畫板——吉星高照</h2>
          <button class="trash">
            <span class="material-icons cart">&#xe872;</span>
          </button>
          <span class="price" data-price="120">$120</span>
          <div class="number">
            <button class="add">+</button>
            <span class="number">1</span>
            <button class="subtract">-</button>
          </div>
          <span class="total">$120</span>
        </div>

      </div>

      <div class="count_area">
        <div class="up">
          <span class="totoal">合計：</span>
          <span class="totoal_price">$340</span>
          <span class="deliver">運費：</span>
          <span class="deliver_price">$60</span>
          <span class="discount">優惠折扣：</span>
          <span class="discount_price">-$0</span>
        </div>
        <div class="short_hr_line"></div>
        <div class="down">
          <span class="all">總計：</span>
          <span class="all_price">$400</span>
        </div>
        <button class="buy">
          前往結帳
          <span class="material-icons cart">&#xf1cc;</span>
        </button>
      </div>

    </main>

    <footer class="footer">
      <div class="page_link">
        <ul class="page_link">
          <li><a href="./exploring.html">老屋探索</a></li>
          <li><a href="./story.html">老屋故事</a></li>
          <li><a href="">文創商品</a></li>
          <li><a href="">我的最愛</a></li>
        </ul>
      </div>
      <p class="declaration">本網站為緯育TibaMe前端設計工程師班第70期學員專題作品，本平台僅供學習、展示之用。參考資源：<a href=" https://www.nakagawa-masashichi.jp/shop/pages/shikasarukitsune.aspx"> 鹿猿狐ビルヂング </a>。若有侵權疑慮，您可以私訊<a href="https://www.facebook.com/webindex/">[TibaMe-前端設計工程師養成班]</a>，後續會由專 人協助處理</p>
      <div class="index_page_link">
        <a class="text_logo" href="./index.html"><img src="../images/text_logo.png" alt="文字logo"></a>
        <a class="logo_image" href="./index.html"><img src="../images/logo_footer.png" alt="logo圖案"></a>
      </div>
    </footer>

    <script src="../js/common/header.js"></script>
    <script>
      $(document).ready(function(){

        // 商品數量增減
        document.addEventListener("click", function(e){

          if(e.target.classList.contains("add")){
            let productCount = e.target.nextElementSibling;
            let productCountNumber = Number(productCount.innerText);
            productCount.innerText = (++productCountNumber).toString();

            let total = $(e.target).closest("div.product").find("span.total");
            let priceSpan = $(e.target).closest("div.product").find("span.price");
            let price = Number(priceSpan.attr("data-price"));
            totalPrice = price * productCountNumber;
            total.get(0).innerText = "$" + totalPrice.toString();
          }

          if(e.target.classList.contains("subtract")){
            let productCount = e.target.previousElementSibling;
            let productCountNumber = Number(productCount.innerText);
            if(productCountNumber > 1){
              productCount.innerText = (--productCountNumber).toString();
            }

            let total = $(e.target).closest("div.product").find("span.total");
            let priceSpan = $(e.target).closest("div.product").find("span.price");
            let price = Number(priceSpan.attr("data-price"));
            totalPrice = price * productCountNumber;
            total.get(0).innerText = "$" + totalPrice.toString();
          }

        });


        //刪除商品
        $("button.trash").on("click", function(){
          let product = this.closest("div.product");
          $(product).fadeOut(500);
          setTimeout(function(){
            product.remove();
          }, 500);
        });


        //總計
        document.addEventListener("click", function(){
          let price = document.querySelectorAll("span.total");
          let priceArr = [];
          for(let i = 1; i < price.length; i++){
            let thisPrice = price[i].innerText.replace("$", "");
            priceArr.push(parseInt(thisPrice, 10));
          }

          let total = priceArr.reduce((accu, item) => {return accu + item}, 0);
          $("span.totoal_price").text("$" + total.toString());

          let deliverFee = parseInt($("span.deliver_price").text().replace("$", ""));
          let discount = parseInt($("span.discount_price").text().replace("$", ""));
          let final = total + deliverFee - discount;
          $("span.all_price").text("$" + final.toString());
        });

      });
    </script>

  </body>
</html>
